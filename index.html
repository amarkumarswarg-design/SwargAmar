<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Swarg – Mini Social Network</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body{background:#f0f2f5}
.tab{display:none}
.tab.active{display:block}
</style>
</head>

<body class="pb-24">

<!-- AUTH -->
<div id="auth" class="fixed inset-0 bg-white flex items-center justify-center z-50">
<div class="w-full max-w-sm p-6">
<h1 class="text-6xl font-black text-blue-600 text-center mb-6">Swarg</h1>

<div id="loginBox" class="space-y-4">
<input id="lUser" placeholder="Username" class="w-full p-4 rounded-xl bg-slate-100">
<input id="lPass" type="password" placeholder="Password" class="w-full p-4 rounded-xl bg-slate-100">
<button onclick="login()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black">Login</button>
<p class="text-center text-sm">New user?
<span onclick="toggle(true)" class="text-blue-600 font-bold cursor-pointer">Register</span></p>
</div>

<div id="regBox" class="hidden space-y-4">
<input id="rName" placeholder="Full Name" class="w-full p-4 rounded-xl bg-slate-100">
<input id="rUser" placeholder="Username" class="w-full p-4 rounded-xl bg-slate-100">
<input id="rPass" type="password" placeholder="Password" class="w-full p-4 rounded-xl bg-slate-100">
<button onclick="register()" class="w-full bg-green-600 text-white py-4 rounded-xl font-black">Create</button>
<p onclick="toggle(false)" class="text-center text-sm text-blue-600 cursor-pointer">Back to login</p>
</div>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<header class="bg-white sticky top-0 p-4 flex justify-between shadow">
<h2 class="font-black text-blue-600 text-2xl">Swarg</h2>
<button onclick="showTab('search')"><i class="fas fa-search"></i></button>
</header>

<main class="max-w-md mx-auto">

<!-- FEED -->
<section id="feed" class="tab active p-4 space-y-4">
<div class="bg-white p-4 rounded-xl">
<textarea id="postTxt" class="w-full p-2" placeholder="What's on your mind?"></textarea>
<button onclick="post()" class="bg-blue-600 text-white px-6 py-2 rounded-xl mt-2 font-bold">Post</button>
</div>
<div id="wall" class="space-y-4"></div>
</section>

<!-- SEARCH -->
<section id="search" class="tab p-4">
<input id="searchInput" onkeyup="searchUser(this.value)" placeholder="Search user"
class="w-full p-4 rounded-xl bg-white mb-4">
<div id="searchRes" class="space-y-3"></div>
</section>

<!-- PROFILE -->
<section id="profile" class="tab p-4 text-center">
<img id="pDp" class="w-24 h-24 mx-auto rounded-full bg-slate-200">
<h2 id="pName" class="font-black mt-3"></h2>
<p id="pUser" class="text-blue-600"></p>
<p class="mt-2 text-sm">
<span id="pPosts">0</span> posts •
<span id="pFollowers">0</span> followers •
<span id="pFollowing">0</span> following
</p>
<button onclick="logout()" class="mt-6 text-red-500 font-bold">Logout</button>
</section>

</main>

<nav class="fixed bottom-0 w-full bg-white flex justify-around p-3 shadow">
<button onclick="showTab('feed')"><i class="fas fa-home"></i></button>
<button onclick="showTab('search')"><i class="fas fa-compass"></i></button>
<button onclick="showTab('profile')"><i class="fas fa-user"></i></button>
</nav>
</div>

<script>
let me=null;

function db(){
if(!localStorage.users)localStorage.users=JSON.stringify([]);
if(!localStorage.posts)localStorage.posts=JSON.stringify([]);
}

window.onload=()=>{
db();
const s=localStorage.session;
if(s)start(s);
};

function toggle(r){
loginBox.classList.toggle('hidden',r);
regBox.classList.toggle('hidden',!r);
}

function register(){
let users=JSON.parse(localStorage.users);
if(users.some(u=>u.user===rUser.value))return alert("Username exists");
users.push({
name:rName.value,
user:rUser.value.toLowerCase(),
pass:rPass.value,
followers:[],
following:[]
});
localStorage.users=JSON.stringify(users);
toggle(false);
}

function login(){
let users=JSON.parse(localStorage.users);
let u=users.find(x=>x.user===lUser.value.toLowerCase()&&x.pass===lPass.value);
if(!u)return alert("Wrong login");
localStorage.session=u.user;
start(u.user);
}

function start(username){
let users=JSON.parse(localStorage.users);
me=users.find(u=>u.user===username);
auth.classList.add('hidden');
app.classList.remove('hidden');
sync();
render();
}

function sync(){
let users=JSON.parse(localStorage.users);
me=users.find(u=>u.user===me.user);
pName.innerText=me.name;
pUser.innerText="@"+me.user;
pFollowers.innerText=me.followers.length;
pFollowing.innerText=me.following.length;
pPosts.innerText=JSON.parse(localStorage.posts).filter(p=>p.user===me.user).length;
}

function post(){
if(!postTxt.value.trim())return;
let posts=JSON.parse(localStorage.posts);
posts.unshift({id:Date.now(),user:me.user,txt:postTxt.value,likes:[]});
localStorage.posts=JSON.stringify(posts);
postTxt.value="";
render();sync();
}

function render(){
let posts=JSON.parse(localStorage.posts);
wall.innerHTML=posts.map(p=>`
<div class="bg-white p-4 rounded-xl">
<b>@${p.user}</b>
<p>${p.txt}</p>
<button onclick="like(${p.id})">
❤️ ${(p.likes||[]).length}
</button>
</div>`).join('');
}

function like(id){
let posts=JSON.parse(localStorage.posts);
let p=posts.find(x=>x.id===id);
p.likes=p.likes||[];
let i=p.likes.indexOf(me.user);
i==-1?p.likes.push(me.user):p.likes.splice(i,1);
localStorage.posts=JSON.stringify(posts);
render();
}

function searchUser(q){
let users=JSON.parse(localStorage.users)
.filter(u=>u.user.includes(q.toLowerCase())||u.name.toLowerCase().includes(q.toLowerCase()));
searchRes.innerHTML=users.map(u=>`
<div class="bg-white p-4 rounded-xl flex justify-between">
<span>@${u.user}</span>
${u.user!==me.user?
`<button onclick="follow('${u.user}')" class="text-blue-600 font-bold">
${me.following.includes(u.user)?'Unfollow':'Follow'}
</button>`:''}
</div>`).join('');
}

function follow(u){
let users=JSON.parse(localStorage.users);
let m=users.find(x=>x.user===me.user);
let t=users.find(x=>x.user===u);
let i=m.following.indexOf(u);
i==-1?(m.following.push(u),t.followers.push(me.user)):
(m.following.splice(i,1),t.followers.splice(t.followers.indexOf(me.user),1));
localStorage.users=JSON.stringify(users);
sync();searchUser(searchInput.value);
}

function showTab(t){
document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
document.getElementById(t).classList.add('active');
if(t==='feed')render();
if(t==='profile')sync();
}

function logout(){
localStorage.removeItem('session');
location.reload();
}
</script>
</body>
</html>
